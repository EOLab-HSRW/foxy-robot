import subprocess

def select_programmer(programmers):
    # This line diisplays a list of available programmers so the user can select one
    for i, programmer in enumerate(programmers):
        print(f"{i+1}. {programmer['desc']} ({programmer['id']})")
    
    choice = int(input("Select programmer: ")) - 1
    return programmers[choice]

def program_device(programmer, port, firmware_file):
    cmd = [
        "avrdude",
        "-c", programmer['id'],
        "-P", port,
        "-b", str(programmer.get('baudrate', 115200)),
        "-U", f"flash:w:{firmware_file}:i"
    ]
    subprocess.run(cmd)

def main():
    # Programmer data from avrdude.conf
    programmers = [
        # I used 2 programmers
        {"id": "arduino", "desc": "Arduino", "connection_type": "serial"},
        {"id": "usbasp", "desc": "USBasp", "connection_type": "usb"},
        # more programmers can be added 
    ]
    
    programmer = select_programmer(programmers)
    
    port = input("Enter port (e.g., /dev/ttyUSB0 or COM3): ")
    firmware_file = input("Enter path to firmware file: ")
    
    program_device(programmer, port, firmware_file)

if __name__ == "__main__":
    main()
